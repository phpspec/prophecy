language: php

sudo: false

cache:
  directories:
    - $HOME/.composer/cache

branches:
  except:
    - /^bugfix\/.*$/
    - /^feature\/.*$/
    - /^optimization\/.*$/

env:
  global:
    - COMPOSER_ARGS="--prefer-stable --no-interaction"

matrix:
  fast_finish: true
  include:
    - php: 5.3
    - php: 5.4
    - php: 5.5
    - php: 5.6
    - php: 7.0
    - php: 7.1
    - php: 7.1
      env:
        - COMPOSER_ARGS="--prefer-stable --prefer-lowest --no-interaction"
    - php: hhvm
      # Use the newer stack for HHVM as HHVM does not support Precise anymore since a long time and so Precise has an outdated version
      sudo: required
      dist: trusty
      group: edge

before_install:
  - phpenv config-rm xdebug.ini || return 0

install:
  - travis_retry composer update $COMPOSER_ARGS

script:
  - vendor/bin/phpspec run -fpretty -v
  - vendor/bin/phpunit
